<%
  id ||= "input-field-#{SecureRandom.uuid}"
  input ||= {}
  input = { id: "#{id}-input" }.merge(input).deep_symbolize_keys
  label ||= {}
  label = { id: "#{id}-label" }.merge(label).deep_symbolize_keys
  hint ||= {}
  hint = { id: "#{id}-hint" }.merge(hint).deep_symbolize_keys
  error ||= {}
  error = { id: "#{id}-error" }.merge(error).deep_symbolize_keys



  shared_helper = GovukPublishingComponents::Presenters::SharedHelper.new(local_assigns)

  id ||= "input-#{SecureRandom.hex(4)}"
  value ||= nil
  type ||= "text"
  describedby ||= nil
  controls ||= nil
  data ||= nil
  autocomplete ||= nil

  label ||= nil
  hint ||= nil
  error_message ||= nil
  error_items ||= []
  grouped ||= nil
  autofocus ||= nil
  tabindex ||= nil
  readonly ||= nil
  maxlength ||= nil
  width ||= nil
  has_error ||= error_message || error_items.any?
  hint_id = "hint-#{SecureRandom.hex(4)}"
  error_id = "error-#{SecureRandom.hex(4)}"
  search_icon ||= nil
  heading_size = false unless ['s', 'm', 'l', 'xl'].include?(heading_size)
  heading_level ||= nil
  prefix ||= nil
  suffix ||= nil

  css_classes = %w(gem-c-input govuk-input)
  css_classes << "govuk-input--error" if has_error
  css_classes << "govuk-input--width-#{width}" if [2, 3, 4, 5, 10, 20, 30].include?(width)
  css_classes << "gem-c-input--search-icon" if search_icon
  form_group_css_classes = %w(govuk-form-group)
  form_group_css_classes << "govuk-form-group--error" if has_error && !grouped

  aria_described_by ||= nil
  if hint || has_error || describedby
    aria_described_by = []
    aria_described_by << hint_id if hint
    aria_described_by << error_id if has_error && !grouped
    aria_described_by << describedby if describedby
    aria_described_by = aria_described_by.join(" ")
  end

  if type == "number"
    type = "text"
    inputmode = "numeric"
    pattern = "[0-9]*"
  end

  inputmode ||= nil
  pattern ||= nil
%>

<%= content_tag :div, class: "gem-c-input-field" do %>
  <%= render "govuk_publishing_components/components/form_field", {
    label: label,
    hint: hint,
    error: error,
  } do (ids) %>
    <% input_tag = tag.input name: name,
      value: value,
      class: css_classes,
      id: id,
      type: type,
      data: data,
      autocomplete: autocomplete,
      tabindex: tabindex,
      autofocus: autofocus,
      readonly: readonly,
      maxlength: maxlength,
      inputmode: inputmode,
      pattern: pattern,
      aria: {
        describedby: aria_described_by,
        controls: controls
      }
    %>

    <% if prefix && suffix %>
      <%= tag.div class: "govuk-input__wrapper" do %>
        <% # The line below relies on in-line styling for legacy browsers and it's whitespace-sensitive %>
        <%= tag.span prefix, class: "govuk-input__prefix", aria: { hidden: true } %><%= input_tag %><%= tag.span suffix, class: "govuk-input__suffix", aria: { hidden: true } %>
      <% end %>
    <% elsif prefix %>
      <%= tag.div class: "govuk-input__wrapper" do %>
        <%= tag.span prefix, class: "govuk-input__prefix", aria: { hidden: true } %><%= input_tag %>
      <% end %>
    <% elsif suffix %>
      <%= tag.div class: "govuk-input__wrapper" do %>
        <%= input_tag %><%= tag.span suffix, class: "govuk-input__suffix", aria: { hidden: true } %>
      <% end %>
    <% else %>
      <%= input_tag %>
    <% end %>
  <% end %>
<% end %>
