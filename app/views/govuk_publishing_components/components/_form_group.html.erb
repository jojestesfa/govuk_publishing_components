<%
  for_id ||= "form-field-#{SecureRandom.hex(4)}"

  label = if label.is_a?(Hash)
            label.dup
          elsif label.present?
            { text: label }
          end
  label[:html_for] = for_id if label && !label&.has_key?(:html_for)

  heading_level = label.delete(:heading_level)
  shared_helper = GovukPublishingComponents::Presenters::SharedHelper.new(local_assigns)

  hint = if hint.is_a?(Hash)
           hint.dup
         elsif hint.present?
          { text: hint }
         end
  hint[:id] = "#{for_id}-hint" if hint && !hint.has_key?(:id)

  error = if error.is_a?(Hash)
            error.dup
          elsif error.present?
            { text: error }
          end
  error[:id] = "#{for_id}-error" if error && !error.has_key?(:id)

  css_classes = %w(gem-c-form-group govuk-form-group)
  css_classes << "govuk-form-group--error" if error

  field_options = {
    label_for: label&.[](:html_for),
    describedby: {
      hint: hint&.[](:id),
      error: error&.[](:id),
    }.compact,
    has_error: error.present?
  }
%>

<%= content_tag :div, class: css_classes do %>
  <% if label && heading_level %>
    <%= content_tag(shared_helper.get_heading_level, class: "govuk-label-wrapper") do %>
      <%= render "govuk_publishing_components/components/label", label %>
    <% end %>
  <% elsif label %>
    <%= render "govuk_publishing_components/components/label", label %>
  <% end %>

  <%= render "govuk_publishing_components/components/hint", hint if hint %>
  <%= render "govuk_publishing_components/components/error_message", error if error %>

  <%= yield(field_options) %>
<% end %>
